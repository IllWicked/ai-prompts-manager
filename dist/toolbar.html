<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body {
            background: transparent;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
            width: 100%;
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            font-size: 13px;
        }
        
        .container {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .toolbar {
            display: flex;
            gap: 2px;
            background: #2D2D2D;
            border-radius: 10px;
            padding: 4px;
            border: 1px solid rgba(255, 255, 255, 0.12);
        }
        
        .btn {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: hsl(50 9% 73.7%);
            transition: all 0.15s;
        }
        
        .btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: hsl(48 33.3% 97.1%);
        }
        
        .btn:active {
            transform: scale(0.95);
        }
        
        .btn.active {
            background: rgba(255, 255, 255, 0.15);
            color: hsl(48 33.3% 97.1%);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="toolbar">
            <button class="btn" id="btn-back" title="Назад">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/>
                </svg>
            </button>
            <button class="btn" id="btn-forward" title="Вперёд">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/>
                </svg>
            </button>
            <button class="btn" id="btn-reload" title="Перезагрузить">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                </svg>
            </button>
            <button class="btn" id="btn-downloads" title="Загрузки">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                </svg>
            </button>
        </div>
    </div>
    
    <script type="module">
        const { invoke } = window.__TAURI__.core;
        const { listen } = window.__TAURI__.event;
        
        const btnDownloads = document.getElementById('btn-downloads');
        let isPopupOpen = false;
        
        async function togglePopup() {
            isPopupOpen = !isPopupOpen;
            btnDownloads.classList.toggle('active', isPopupOpen);
            
            if (isPopupOpen) {
                await invoke('show_downloads');
            } else {
                await invoke('hide_downloads');
            }
        }
        
        // Listen for popup close from downloads webview
        listen('downloads-closed', () => {
            isPopupOpen = false;
            btnDownloads.classList.remove('active');
        });
        
        // Listen for global click events to close popup
        // This is triggered by Claude webview clicks
        listen('global-click', () => {
            if (isPopupOpen) {
                isPopupOpen = false;
                btnDownloads.classList.remove('active');
                invoke('hide_downloads');
            }
        });
        
        // Event listeners
        document.getElementById('btn-back').onclick = () => invoke('toolbar_back');
        document.getElementById('btn-forward').onclick = () => invoke('toolbar_forward');
        document.getElementById('btn-reload').onclick = () => invoke('toolbar_reload');
        btnDownloads.onclick = togglePopup;
    </script>
</body>
</html>
